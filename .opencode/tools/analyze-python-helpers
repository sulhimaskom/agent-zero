# Analyze Python Helpers Directory

Analyze python/helpers/ directory structure, complexity hotspots, and code quality issues.

## ANALYSIS AREAS

### 1. Complexity Hotspots
Focus on files >500 lines with large functions:

**Priority P0:**
- `python/helpers/settings.py` (1740 lines)
  - Function `convert_out`: 1134 lines (CRITICAL - needs splitting)
  - TODOs at lines: 1558, 1616, 1621, 1631, 1643 (about background tasks)
  - Functions >50 lines: `get_default_settings` (81), `_apply_settings` (105)

- `python/helpers/task_scheduler.py` (1154 lines)
  - Class `TaskScheduler`: 298 lines, 23 methods (overgrown)
  - Function `_run_task`: 129 lines
  - Function `_run_task_wrapper`: 120 lines

- `python/helpers/mcp_handler.py` (1115 lines)
  - Class `MCPConfig`: 407 lines, 14 methods (heavy)
  - Functions >50 lines: `update` (94), `__init__` (107), `after_execution` (60)

### 2. Code Quality Issues

**TODOs to Report:**
- `python/helpers/settings.py`: 5 TODOs about replacing blocking operations with background tasks
- `python/helpers/task_scheduler.py`: 1 TODO about lowering SLEEP_TIME threshold
- `python/helpers/mcp_handler.py`: 2 TODOs (lines 742-744: inline prompts should be external files)
- `python/helpers/history.py`: 1 FIXME at line 218 (vision bytes sent to utility LLM)

**Temporary Workarounds:**
- `python/helpers/vector_db.py`, `python/helpers/memory.py`: FAISS patch for Python 3.12 ARM (TODO remove upstream fix)

### 3. Module Organization

Check for:
- Monolithic classes that should be split
- Functions that can be extracted
- Code duplication across files
- Missing type hints or docstrings

## OUTPUT FORMAT

```json
{
  "complexity_hotspots": [
    {
      "file": "python/helpers/settings.py",
      "lines": 1740,
      "issue": "convert_out function is 1134 lines - needs splitting into smaller functions"
    },
    {
      "file": "python/helpers/task_scheduler.py",
      "lines": 1154,
      "issue": "TaskScheduler class 298 lines with 23 methods - should extract TaskExecutor"
    }
  ],
  "todos_found": {
    "python/helpers/settings.py": [1558, 1616, 1621, 1631, 1643],
    "python/helpers/task_scheduler.py": [34],
    "python/helpers/mcp_handler.py": [742, 744],
    "python/helpers/history.py": [218]
  },
  "recommendations": [
    "Split settings.py:convert_out into provider_config, model_config, api_config functions",
    "Extract TaskExecutor from task_scheduler.py",
    "Split MCPConfig in mcp_handler.py into ConfigManager, ServerRegistry, ToolRegistry",
    "Fix history.py:218 - send image summary instead of full vision bytes",
    "Remove FAISS patch when Python 3.12 ARM support is fixed upstream"
  ]
}
```
