import{store as speechStore}from"/components/chat/speech/speech-store.min.js";function getTextContent(t,e=!1){const o=[];for(const s of t.children){if(s.classList.contains("action-buttons"))continue;if(s.tagName&&"img"===s.tagName.toLowerCase()){s.src&&o.push(s.src);continue}const t=(e?s.innerHTML:s.innerText)||"";t.trim()&&o.push(t.trim())}return o.join("\n\n")}export function addActionButtonsToElement(t){if(t.querySelector(".action-buttons"))return;const e=document.createElement("div");e.className="action-buttons";const o=document.createElement("button");o.className="action-button copy-action",o.setAttribute("aria-label","Copy text"),o.innerHTML='<span class="material-symbols-outlined">content_copy</span>';const s=document.createElement("div");s.className="action-tooltip",s.textContent="Copied!",s.setAttribute("role","status"),s.setAttribute("aria-live","polite"),o.appendChild(s),o.onclick=async n=>{if(n.stopPropagation(),parseFloat(window.getComputedStyle(e).opacity)<.5)return;const a=getTextContent(t),i=o.querySelector(".material-symbols-outlined");try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(a);else{const t=document.createElement("textarea");t.value=a,t.style.position="fixed",t.style.left="-999999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}i.textContent="check",o.classList.add("success"),o.classList.add("show-tooltip"),setTimeout(()=>{o.classList.remove("show-tooltip")},1500),setTimeout(()=>{i.textContent="content_copy",o.classList.remove("success")},2e3)}catch(t){console.error("Copy failed:",t),i.textContent="error",o.classList.add("error"),s.textContent="Failed!",o.classList.add("show-tooltip"),setTimeout(()=>{o.classList.remove("show-tooltip")},1500),setTimeout(()=>{i.textContent="content_copy",o.classList.remove("error"),s.textContent="Copied!"},2e3)}};const n=document.createElement("button");n.className="action-button speak-action",n.setAttribute("aria-label","Speak text"),n.innerHTML='<span class="material-symbols-outlined">volume_up</span>',n.onclick=async o=>{if(o.stopPropagation(),parseFloat(window.getComputedStyle(e).opacity)<.5)return;const s=getTextContent(t),a=n.querySelector(".material-symbols-outlined");if(s&&0!==s.trim().length)try{a.textContent="check",n.classList.add("success"),setTimeout(()=>{a.textContent="volume_up",n.classList.remove("success")},2e3),await speechStore.speak(s)}catch(t){console.error("Speech failed:",t),a.textContent="error",n.classList.add("error"),setTimeout(()=>{a.textContent="volume_up",n.classList.remove("error")},2e3)}},e.append(o,n),t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}