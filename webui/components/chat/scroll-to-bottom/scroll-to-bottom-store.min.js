import{createStore}from"/js/AlpineStore.min.js";const model={isVisible:!1,newMessageCount:0,chatHistory:null,lastScrollHeight:0,init(){setTimeout(()=>{this.chatHistory=document.getElementById("chat-history"),this.chatHistory&&(this.setupScrollListener(),this.setupMessageObserver(),this.checkScrollPosition())},100)},setupScrollListener(){let e=!1;this.chatHistory.addEventListener("scroll",()=>{e||(window.requestAnimationFrame(()=>{this.checkScrollPosition(),e=!1}),e=!0)},{passive:!0})},setupMessageObserver(){let e=this;new MutationObserver(function(t){let s=!1;t.forEach(function(t){if("childList"===t.type&&t.addedNodes.length>0)t.addedNodes.forEach(function(e){e.nodeType===Node.ELEMENT_NODE&&(e.classList.contains("message-container")||e.querySelector(".message-container"))&&(s=!0)})}),s&&e.isVisible&&e.newMessageCount++}).observe(this.chatHistory,{childList:!0,subtree:!0})},checkScrollPosition(){if(!this.chatHistory)return;let e=this.chatHistory.scrollHeight,t=this.chatHistory.scrollTop,s=this.chatHistory.clientHeight,i=e-t-s>100;this.isVisible=i,!i&&this.newMessageCount>0&&(this.newMessageCount=0),this.lastScrollHeight=e},scrollToBottom(){this.chatHistory&&(this.chatHistory.scrollTo({top:this.chatHistory.scrollHeight,behavior:"smooth"}),this.newMessageCount=0,window.dispatchEvent(new CustomEvent("chat-scrolled-to-bottom")))},reset(){this.newMessageCount=0,this.checkScrollPosition()}};const store=createStore("scrollToBottom",model);export{store};
