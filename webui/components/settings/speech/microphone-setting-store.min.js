import{createStore}from"/js/AlpineStore.min.js";import{TIMING}from"/js/constants.min.js";const model={devices:[],selectedDevice:"",async init(){let e=null;try{e=localStorage.getItem("microphoneSelectedDevice")}catch(e){}await this.loadDevices(),e&&this.devices.some(i=>i.deviceId===e)&&(this.selectedDevice=e)},async loadDevices(){const e=await navigator.mediaDevices.enumerateDevices();this.devices=e.filter(e=>"audioinput"===e.kind&&e.deviceId),this.selectedDevice=this.devices.length>0?this.devices[0].deviceId:""},requestingPermission:!1,permissionTimer:null,permissionAttempts:0,async requestPermission(){clearTimeout(this.permissionTimer),this.requestingPermission=!0,this.permissionAttempts=0,setTimeout(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0}),this.pollForDevices()}catch(e){console.error("Microphone permission denied"),this.requestingPermission=!1}},0)},async pollForDevices(){await this.loadDevices(),this.devices.some(e=>e.deviceId&&""!==e.deviceId)||this.permissionAttempts>=60?this.requestingPermission=!1:(this.permissionAttempts++,this.permissionTimer=setTimeout(()=>this.pollForDevices(),TIMING.POLL_INTERVAL))},async selectDevice(e){this.selectedDevice=e,this.onSelectDevice()},async onSelectDevice(){try{localStorage.setItem("microphoneSelectedDevice",this.selectedDevice)}catch(e){}},getSelectedDevice(){let e=this.devices.find(e=>e.deviceId===this.selectedDevice);return!e&&this.devices.length>0&&(e=this.devices.find(e=>"default"===e.deviceId)||this.devices[0]),e}},store=createStore("microphoneSetting",model);export{store};