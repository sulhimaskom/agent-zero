import{importComponent as e}from"/js/components.js";import{UI as t}from"./constants.js";const o=[],l=document.createElement("div");function n(){const e=t.BASE_Z_INDEX;if(o.forEach((o,l)=>{o.element.style.zIndex=e+l*t.Z_INDEX_STEP}),l.style.display="block",o.length>1){const n=o.length-1,s=e+(n-1)*t.Z_INDEX_STEP;l.style.zIndex=s+t.BACKDROP_OFFSET}else 1===o.length?l.style.zIndex=e-1:l.style.display="none"}l.className="modal-backdrop",l.style.display="none",l.style.backdropFilter="blur(5px)",document.body.appendChild(l);export function openModal(t){return new Promise(l=>{try{const s=function(e){const t=document.createElement("div");t.className="modal",t.path=e;let o=null;t.addEventListener("mousedown",e=>{o=e.target}),t.addEventListener("mouseup",e=>{e.target===t&&o===t&&closeModal(),o=null});const l=document.createElement("div");l.className="modal-inner";const s=document.createElement("div");s.className="modal-header";const d=document.createElement("h2");d.className="modal-title";const a=document.createElement("button");a.className="modal-close",a.innerHTML="&times;",s.appendChild(d),s.appendChild(a);const c=document.createElement("div");c.className="modal-scroll";const r=document.createElement("div");r.className="modal-bd",c.appendChild(r);const i=document.createElement("div");i.className="modal-footer-slot",i.style.display="none",l.appendChild(s),l.appendChild(c),l.appendChild(i),t.appendChild(l);const m=t.querySelector(".modal-close");return m.addEventListener("click",()=>closeModal()),document.body.appendChild(t),t.classList.add("show"),n(),{path:e,element:t,title:t.querySelector(".modal-title"),body:t.querySelector(".modal-bd"),close:m,footerSlot:t.querySelector(".modal-footer-slot"),inner:t.querySelector(".modal-inner"),styles:[],scripts:[]}}(t);new MutationObserver((e,t)=>!document.contains(s.element)&&(t.disconnect(),l())).observe(document.body,{childList:!0,subtree:!0}),s.body.textContent="";const d=document.createElement("div");d.className="loading",d.textContent="Loading...",s.body.appendChild(d);e(t,s.body).then(e=>{if(s.title.textContent=e.title||t,e.html&&e.html.classList){const t=s.element.querySelector(".modal-inner");t&&t.classList.add(...e.html.classList)}e.body&&e.body.classList&&s.body.classList.add(...e.body.classList),requestAnimationFrame(()=>{const e=s.body.querySelector("[data-modal-footer]");e&&s.footerSlot&&(s.footerSlot.appendChild(e),s.footerSlot.style.display="block",s.inner.classList.add("modal-with-footer"))})}).catch(e=>{console.error("Error loading modal content:",e),s.body.textContent="";const t=document.createElement("div");t.className="error",t.textContent="Failed to load modal content: "+e.message,s.body.appendChild(t)}),s.path=t,o.push(s),s.element.classList.add("show"),document.body.style.overflow="hidden",n()}catch(e){console.error("Error loading modal content:",e),l()}})}export function closeModal(e=null){if(0===o.length)return;let t,s=o.length-1;if(e){if(s=o.findIndex(t=>t.path===e),-1===s)return;t=o[s],o.splice(s,1)}else t=o.pop();t.styles.forEach(e=>{document.querySelector(`[data-modal-style="${e}"]`)?.remove()}),t.scripts.forEach(e=>{document.querySelector(`[data-modal-script="${e}"]`)?.remove()}),t.element.classList.remove("show"),t.element.parentNode&&t.element.parentNode.removeChild(t.element),0===o.length?(l.style.display="none",document.body.style.overflow=""):n()}export function scrollModal(e){if(!e)return;const t=o[o.length-1].element;if(!t)return;const l=t.querySelector(".modal-scroll"),n=t.querySelector(`#${e}`);l&&n&&l.scrollTo({top:n.offsetTop-20,behavior:"smooth"})}globalThis.scrollModal=scrollModal,document.addEventListener("click",async e=>{const t=e.target.closest("[data-modal-content]");if(t){if(e.preventDefault(),t.hasAttribute("disabled")||t.classList.contains("disabled"))return;const o=t.getAttribute("href");await openModal(o)}}),document.addEventListener("keydown",e=>{"Escape"===e.key&&o.length>0&&closeModal()}),globalThis.openModal=openModal,globalThis.closeModal=closeModal,globalThis.scrollModal=scrollModal;